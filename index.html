<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/jspsych-psychophysics.js"></script>
    <script src="jspsych/plugin-html-button-response.js"></script>
    <script src="jspsych/plugin-fullscreen.js"></script>
    <script src="jspsych/plugin-virtual-chinrest.js"></script>
    <script src="src/helper.js"></script>
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css"/>
    <title>Visual Search Task</title>
</head>
<body> 
</body>
<script>

    // Initialize jsPsych
    const jsPsych = initJsPsych({
        on_finish: () => {
            jsPsych.data.displayData();
        }
    });

    console.log(trialLog);


    // Run in JATOS server?
    const jatos_run = window.jatos !== undefined || false;

    const timeline = [];  

    const welcome = {
    type: jsPsychHtmlButtonResponse,
    stimulus: "<p>Experiment under construction.</p></br>",
    choices: ['Continue']
    };

    timeline.push(welcome);

    /*
    Idea for conditional trials. Incude event in timeline but make it conditional to timelines variables
    */
    const resize = {
        type: jsPsychVirtualChinrest,
        blindspot_reps: 1,
        resize_units: "none",
        pixels_per_unit: 100
    };
    const full_on = {
        type: jsPsychFullscreen,
        fullscreen_mode: true,
        message: "<p>Antes de empezar, pulsa el bot√≥n para entrar en modo pantalla completa.</p>",
        button_label: "Entrar en pantalla completa",
    }

    // Trial with psychophysics

    const trial = {
        type: jsPsychPsychophysics,
        stimuli: () => {
            // This fix the problem of sacle the whole canvas
            const sF  = jsPsych.data.get().last(1).values()[0].px2deg;
            return [...draw_display(sF*1, sF*0.1, sF*4, "circle", "red", 1, 5)]
        },
        choices: ['y', 'n'], // The participant can respond to the stimuli using the 'y' or 'n' key.
        background_color: '#000000', // The HEX color means green.
    };

    timeline.push(resize, trial);

    jsPsych.run(timeline);

</script>
</html>